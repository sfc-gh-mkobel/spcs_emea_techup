# spcs_emea_techup
## Account setup

```sql
use role accountadmin;

CREATE OR REPLACE ROLE TECHUP_DEMO_ROLE;
GRANT ROLE TECHUP_DEMO_ROLE TO ROLE ACCOUNTADMIN ;

GRANT CREATE DATABASE ON ACCOUNT TO ROLE TECHUP_DEMO_ROLE;
GRANT CREATE COMPUTE POOL ON ACCOUNT TO ROLE TECHUP_DEMO_ROLE;
GRANT CREATE WAREHOUSE ON ACCOUNT TO ROLE TECHUP_DEMO_ROLE;
GRANT CREATE INTEGRATION ON ACCOUNT TO ROLE TECHUP_DEMO_ROLE;
GRANT BIND SERVICE ENDPOINT ON ACCOUNT TO ROLE TECHUP_DEMO_ROLE;

USE ROLE TECHUP_DEMO_ROLE;

CREATE WAREHOUSE IF NOT EXISTS TECHUP_DEMO_WH WAREHOUSE_SIZE = XSMALL AUTO_SUSPEND = 120 AUTO_RESUME = TRUE;

CREATE SECURITY INTEGRATION IF NOT EXISTS tutorial_integration
  TYPE=oauth
  OAUTH_CLIENT=snowservices_ingress
  ENABLED=true;

--GRANT USAGE ON INTEGRATION SNOWSERVICES_INGRESS_OAUTH TO ROLE TECHUP_DEMO_ROLE;

--GRANT BIND SERVICE ENDPOINT ON ACCOUNT TO ROLE TECHUP_DEMO_ROLE;


CREATE COMPUTE POOL TECHUP_DEMO_COMPUTE_POOL
  MIN_NODES = 1
  MAX_NODES = 1
  INSTANCE_FAMILY = CPU_X64_S;;

--GRANT USAGE, MONITOR ON COMPUTE POOL TECHUP_DEMO_COMPUTE_POOL TO ROLE TECHUP_DEMO_ROLE;


USE ROLE TECHUP_DEMO_ROLE;


--CREATE WAREHOUSE IF NOT EXISTS TECHUP_DEMO_WH_XL WAREHOUSE_SIZE = XLARGE AUTO_SUSPEND = 120 AUTO_RESUME = TRUE;

CREATE DATABASE TECHUP_DEMO_DB;
GRANT OWNERSHIP ON DATABASE TECHUP_DEMO_DB TO ROLE TECHUP_DEMO_ROLE;
CREATE SCHEMA DATA_SCHEMA;

USE DATABASE TECHUP_DEMO_DB;
USE schema DATA_SCHEMA;

CREATE TABLE mytable (amount NUMBER);

INSERT INTO mytable VALUES(1);
INSERT INTO mytable VALUES(2);
INSERT INTO mytable VALUES(3);


CREATE STAGE TECHUP_DEMO_STAGE DIRECTORY = ( ENABLE = true );

CREATE STAGE TECHUP_DEMO_FILE_STAGE ENCRYPTION = (type = 'SNOWFLAKE_SSE');

CREATE IMAGE REPOSITORY TECHUP_DEMO_REPOSITORY;

SHOW IMAGE REPOSITORIES;

select "repository_url" from table(result_scan(last_query_id()));
```

## Clean up

```sql
CREATE SERVICE TECHUP_DEMO_SERVICE
  IN COMPUTE POOL TECHUP_DEMO_COMPUTE_POOL
  FROM @TECHUP_DEMO_STAGE
  SPEC='techup_service.yaml'
  MIN_INSTANCES=1
  MAX_INSTANCES=1;
```


### Monitor service
```sql
show endpoints in service TECHUP_DEMO_SERVICE;
SELECT SYSTEM$GET_SERVICE_STATUS('TECHUP_DEMO_SERVICE');
SELECT SYSTEM$GET_SERVICE_LOGS('TECHUP_DEMO_SERVICE',0, 'techup-service');

select
  v.value:containerName::varchar container_name
  ,v.value:status::varchar status  
  ,v.value:message::varchar message
from (select parse_json(system$get_service_status('TECHUP_DEMO_SERVICE'))) t,
lateral flatten(input => t.$1) v;
```




## Clean up

```sql
-- clean up
USE ROLE TECHUP_DEMO_ROLE;
DROP SERVICE TECHUP_DEMO_SERVICE FORCE;
DROP DATABASE TECHUP_DEMO_DB;
use role accountadmin;
DROP COMPUTE POOL TECHUP_DEMO_COMPUTE_POOL;
DROP ROLE TECHUP_DEMO_ROLE;
DROP WAREHOUSE TECHUP_DEMO_WH;
```
